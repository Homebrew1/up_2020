### Main Target

1. 前端发布策略
2. 后端发布策略



## 01. 前端发布策略

#### 前端发布的本质

就是静态资源的发布 （js,css）



#### 野生状态下的前端资源

1. 有一个HTML
2. HTML中引入了一个CSS
3. CSS和HTML模板都由服务器反向代理

#### 能使用缓存么？

1. 协商缓存？
2. 本地缓存！



#### 本地缓存怎么更新呢？

静态资源都加上版本号！

**用Hash 代替 Version**



#### 考虑CDN场景

**CDN场景下的更新**

HTML页面和静态资源，谁先部署？

+ 页面先部署
+ 静态资源先部署

**好像都不太好...**





#### 最终方案：非覆盖发布

非覆盖下的资源更新



### 浅谈CDN

1. 内容分发网络
2.  用户 --> CDN --> 源站
3. CDN回源



## 02. 后端发布策略



#### 后端发布的本质

后端服务在多台服务器上的分发



#### 后端发布关心的问题

+ 减少用户感知上的新旧版本不一致
+ 让发布过程中的服务尽可能的稳定
+ 保证最终一致



#### 滚动更新

应用的新版本逐步替换旧版本。在此期间，新旧版本会共存

+ 节约资源
+ 流量冲击小
+ 回滚不及时
+ 存在中间状态，可能导致不一致



#### 蓝绿部署

不停止老版本，部署新版本并进行测试，确认Ok后，将流量切到新版本

+ 风险小，新的版本有问题不会影响到线上
+ 便于快速回滚
+ 切换流量时要妥善处理未完成请求
+ 整体切换流量冲击较大



#### 灰度发布/金丝雀发布

在原有软件生产版本可用的情况下，同事部署一个新的版本。两个版本同事存在于线上，为新版本分配少量流量，线上验证完毕后再将新版本推广

+ 渐进式，风险较小
+ 需配合复杂的路由策略



### 最后小结

+ 前端发布策略

  从野生页面到非覆盖式发布

+ 后端发布策略

  滚动更新、蓝绿部署、灰度发布

