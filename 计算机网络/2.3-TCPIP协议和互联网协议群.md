#### 课程目标

+ 面试重点
+ 计网基础
+ 底层架构



### 课程内容

+ TCP/IP协议群简介
+ 三次握手
+ 传输和处理数据顺序
+ 挥手（中断连接）



## 01.  TCP/IP协议群简介

#### 互联网协议群（Internet Protocal Suite）

类似OSI模型，一种网络协议的概念模型

1. 应用层（Application）
2. 传输层（Transport）
3. 网络层（Internet）
4. 链接层（Link）
5. 物理层（Physical）



#### 应用层（Application Layer）

+ 提供应用间通信能力（HTTP协议）



#### 传输层（Transport Layer）

+ 提供主机到主机（host-to-host）的通信能力

  （TCP/UDP协议）



#### 网络层（Internet Layer）

+ 提供地址到地址的通信能力

  (IP协议)



#### 链路层（Link Layer）

+ 提供设备到设备的通信能力

  (多种底层网络协议 Ethernet，WI-FI...)

  from： mac地址

  to:  mac地址

  数据...



#### 重要标识

+ 设备   -   MAC:00 1A 3F F1 4C C6
+ 位置   -   ipv4: 10.18.3.65
  		  -   ipv6:  fe80:b166:4d55:2584:70a3
+ 应用   -   port: 8080



#### TCP/IP封包

+ Application Layer  --- 数据
+ Transport Layer  ---  TCP Header  TCP数据
+ Internet Layer ---  IP Header  IP数据
+ Link  Layer  ---  Frame Header      Frame Data      Frame Footer

**IP封包**

|          |            |      |      |      |
| -------- | ---------- | ---- | ---- | ---- |
| 源IP地址 | 目标IP地址 | 协议 | ...  | 数据 |

**TCP封包**

| 187.20.15.3 | 10.20.33.5 | 6    | ...  | 80     | 80       | 数据... |
| ----------- | ---------- | ---- | ---- | ------ | -------- | ------- |
|             |            |      |      | 源端口 | 目标端口 | ....    |

​																											TCP封包

**完整的TCP协议头**

![image-20200908102757697](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908102757697.png)



#### TCP协议封包

+ 每个封包称作一个TCP信息段（TCP Segment
+ Header 用于描述传输行为（如源端口，目标端口）
+ Header后面跟若干 byte 数据，每个 byte 拥有自己的序列号

|            | Seq  |      |      |      |      |      |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| TCP Header | 5    | 6    | 7    | 8    | 9    | ...  |



## 02. 建立连接为什么要三次握手？

TCP/IP的三次握手

![image-20200908103057523](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908103057523.png)





## 03. 数据顺序的处理

思考：解决数据顺序

确定个消息的顺序：绝对时间

+ 使用发送、接收时间
  + 服务器时间差异如何解决
+ 使用自增序号
  + A-B-A-B类型会话可以解决？
  + A-(AB)-B类型会话如何解决？

#### TCP/IP协议的处理方法

+ 消息的绝对顺序用（SEQ,ACK）这一对元祖描述
  + SEQ (Sequence) ：这个消息发送前一共发送了多少字节
  + ACK（Acknoewledge）：这个消息发送前一共收到了多少个字节



#### 三次握手

![image-20200908103501973](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908103501973.png)



#### 数据传送

![image-20200908103528602](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908103528602.png)



#### 顺序解决

![image-20200908103547589](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908103547589.png)





## 04. 中断连接

![image-20200908103609707](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908103609707.png)

![image-20200908103621761](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908103621761.png)

![image-20200908103637488](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20200908103637488.png)





### 总结与思考

+ 最简化原则：没有足够的事情要做，就不必分层
+ 思考计算机对话和人对话的区别？为什么需要三次握手？
+ 网络中的顺序问题，TCP协议给了完美的解法，这个方法时可以迁移的，（学算法的价值）